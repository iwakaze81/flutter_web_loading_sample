# Flutter Web ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚µãƒ³ãƒ—ãƒ«

Flutter Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã¨ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚

**ğŸš€ ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆ**: https://iwakaze81.github.io/flutter_web_loading_sample/

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€Flutter Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–ä¸­ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’å®Ÿè£…ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚`flutter_bootstrap.js` ã® `onEntrypointLoaded` ã‚’ä½¿ç”¨ã—ã¦ã€Flutter ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆæœŸåŒ–å®Œäº†æ™‚ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã•ã›ã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

- **ç¾ã—ã„ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ã¨å›è»¢ã™ã‚‹ã‚¹ãƒ”ãƒŠãƒ¼
- **ã‚¹ãƒ ãƒ¼ã‚ºãªãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ**: Flutter ã‚¢ãƒ—ãƒªã®åˆæœŸåŒ–å®Œäº†æ™‚ã«è‡ªå‹•çš„ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†**: åˆæœŸåŒ–ãŒå¤±æ•—ã—ãŸå ´åˆã§ã‚‚30ç§’å¾Œã«è‡ªå‹•çš„ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éè¡¨ç¤º
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚é©åˆ‡ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’çµ‚äº†
- **å†åˆ©ç”¨å¯èƒ½ãªè¨­è¨ˆ**: ã‚¹ã‚¿ã‚¤ãƒ«ã¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ã—ã€ä¿å®ˆæ€§ã‚’å‘ä¸Š

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
web/
â”œâ”€â”€ index.html                  # HTML æ§‹é€ ã®ã¿
â”œâ”€â”€ styles/
â”‚   â””â”€â”€ loading.css            # ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ loading.js             # ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆLoadingController ã‚¯ãƒ©ã‚¹ï¼‰
â””â”€â”€ flutter_bootstrap.js       # Flutter åˆæœŸåŒ–å‡¦ç†

.vscode/
â”œâ”€â”€ launch.json                # ãƒ‡ãƒãƒƒã‚°è¨­å®š
â”œâ”€â”€ settings.json              # Dart/Flutter ã®æ¨å¥¨è¨­å®š
â””â”€â”€ extensions.json            # æ¨å¥¨æ‹¡å¼µæ©Ÿèƒ½

.fvm/
â””â”€â”€ fvm_config.json            # Flutter ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆstable å›ºå®šï¼‰
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. FVM ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ FVM (Flutter Version Management) ã‚’ä½¿ç”¨ã—ã¦ Flutter ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚

```bash
# FVM ã§ Flutter stable ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
fvm install stable

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨
fvm use stable
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
fvm flutter pub get
```

## å®Ÿè¡Œæ–¹æ³•

### é–‹ç™ºãƒ¢ãƒ¼ãƒ‰

```bash
# Chrome ã§å®Ÿè¡Œ
fvm flutter run -d chrome

# ã¾ãŸã¯ VS Code ã§ F5 ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ
```

### ãƒ“ãƒ«ãƒ‰

```bash
# æœ¬ç•ªç”¨ãƒ“ãƒ«ãƒ‰
fvm flutter build web

# ãƒ“ãƒ«ãƒ‰çµæœã¯ build/web/ ã«å‡ºåŠ›ã•ã‚Œã¾ã™
```

## å®Ÿè£…ã®è©³ç´°

### ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°åˆ¶å¾¡ã®ä»•çµ„ã¿

#### 1. **LoadingController ã‚¯ãƒ©ã‚¹** (scripts/loading.js)

ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

ä¸»ãªæ©Ÿèƒ½ï¼š
- `startTimeout()`: 30ç§’ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’é–‹å§‹
- `hide()`: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
- `onError()`: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®å‡¦ç†

#### 2. **Flutter Bootstrap** (flutter_bootstrap.js)

`onEntrypointLoaded` ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ Flutter ã®åˆæœŸåŒ–ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

```javascript
_flutter.loader.load({
  onEntrypointLoaded: async function(engineInitializer) {
    try {
      const appRunner = await engineInitializer.initializeEngine();
      await appRunner.runApp();

      // åˆæœŸåŒ–å®Œäº†å¾Œã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éè¡¨ç¤º
      window.loadingController.hide();
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éè¡¨ç¤º
      window.loadingController.onError(error);
      throw error;
    }
  }
});
```

#### 3. **å‹•ä½œãƒ•ãƒ­ãƒ¼**

1. ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã« `LoadingController` ãŒåˆæœŸåŒ–ã•ã‚Œã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒé–‹å§‹
2. Flutter ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ãŸã‚‰ `hide()` ã‚’å‘¼ã³å‡ºã—
3. ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ `onError()` ã‚’å‘¼ã³å‡ºã—
4. 30ç§’çµŒã£ã¦ã‚‚ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒæ¶ˆãˆãªã„å ´åˆã¯å¼·åˆ¶çš„ã«éè¡¨ç¤º

### ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®æŒ™å‹•

ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã€ä»¥ä¸‹ã®å¯¾ç­–ã«ã‚ˆã‚Šãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®å•é¡Œã‚’å›é¿ã—ã¦ã„ã¾ã™ï¼š

- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†**: åˆæœŸåŒ–ãŒå¤±æ•—ã—ã¦ã‚‚ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒæ°¸é ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’é˜²æ­¢
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚é©åˆ‡ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’çµ‚äº†
- **ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®åˆæœŸåŒ–**: `DOMContentLoaded` ã‚¤ãƒ™ãƒ³ãƒˆã§ç¢ºå®Ÿã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’é–‹å§‹

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ã‚¹ã‚¿ã‚¤ãƒ«ã®å¤‰æ›´

`web/styles/loading.css` ã‚’ç·¨é›†ã—ã¦ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

```css
/* èƒŒæ™¯è‰²ã®å¤‰æ›´ */
#loading {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

/* ã‚¹ãƒ”ãƒŠãƒ¼ã®ã‚µã‚¤ã‚ºã¨è‰² */
.loader {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(255, 255, 255, 0.3);
  border-top: 4px solid white;
}
```

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã®å¤‰æ›´

`web/scripts/loading.js` ã® `LoadingController` ã‚¯ãƒ©ã‚¹ã§å¤‰æ›´ã§ãã¾ã™ã€‚

```javascript
constructor() {
  this.timeout = 30000; // ãƒŸãƒªç§’å˜ä½ï¼ˆ30ç§’ï¼‰
}
```

### ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆæ™‚é–“ã®èª¿æ•´

`web/styles/loading.css` ã¨ `web/scripts/loading.js` ã®ä¸¡æ–¹ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```css
/* CSS */
#loading {
  transition: opacity 0.5s ease-out;
}
```

```javascript
// JavaScript
setTimeout(() => {
  // è¦ç´ ã‚’å‰Šé™¤
}, 500); // CSS ã® transition æ™‚é–“ã¨åˆã‚ã›ã‚‹
```

## é–‹ç™ºç’°å¢ƒ

- **Flutter**: 3.38.9 (stable)
- **Dart**: 3.10.8
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: FVM
- **æ¨å¥¨ã‚¨ãƒ‡ã‚£ã‚¿**: VS Code + Dart/Flutter æ‹¡å¼µæ©Ÿèƒ½

## VS Code ãƒ‡ãƒãƒƒã‚°è¨­å®š

`.vscode/launch.json` ã«ä»¥ä¸‹ã®ãƒ‡ãƒãƒƒã‚°è¨­å®šãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

- **Flutter Web (Chrome)**: Chrome ã§ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ
- **Flutter Web (Edge)**: Edge ã§ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ
- **Flutter Web (Profile Mode)**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šç”¨
- **Flutter Web (Release Mode)**: ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ã®ç¢ºèªç”¨

## GitHub Actions

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯2ã¤ã® GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

### Analyze ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (.github/workflows/analyze.yml)

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã€ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

**å®Ÿè¡Œå†…å®¹:**
- ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æ¤œè¨¼
- `flutter analyze` ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰è§£æ
- `flutter test` ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**ãƒˆãƒªã‚¬ãƒ¼:**
- main, develop ãƒ–ãƒ©ãƒ³ãƒã¸ã® push
- main, develop ãƒ–ãƒ©ãƒ³ãƒã¸ã® pull request

### Deploy ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (.github/workflows/deploy.yml)

main ãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸã¨ãã«è‡ªå‹•çš„ã« GitHub Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

**å®Ÿè¡Œå†…å®¹:**
1. Flutter Web ã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ï¼ˆãƒªãƒªãƒ¼ã‚¹ãƒ¢ãƒ¼ãƒ‰ï¼‰
2. ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ GitHub Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤

**ãƒˆãƒªã‚¬ãƒ¼:**
- main ãƒ–ãƒ©ãƒ³ãƒã¸ã® push

### GitHub Pages ã®è¨­å®š

åˆå›ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ã€ä»¥ä¸‹ã®è¨­å®šãŒå¿…è¦ã§ã™ï¼š

1. GitHub ãƒªãƒã‚¸ãƒˆãƒªã® **Settings** > **Pages** ã«ç§»å‹•
2. **Source** ã‚’ **GitHub Actions** ã«è¨­å®š
3. main ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤ãŒé–‹å§‹ã•ã‚Œã¾ã™

ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€ä»¥ä¸‹ã® URL ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š
```
https://iwakaze81.github.io/flutter_web_loading_sample/
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚è‡ªç”±ã«ä½¿ç”¨ãƒ»æ”¹å¤‰ã—ã¦ãã ã•ã„ã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- [Flutter Web å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.flutter.dev/platform-integration/web)
- [FVM (Flutter Version Management)](https://fvm.app/)
- [flutter_bootstrap.js ã«ã¤ã„ã¦](https://docs.flutter.dev/platform-integration/web/initialization)
